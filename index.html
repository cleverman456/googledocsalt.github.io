<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FoundryGames</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="./imgs/favicon.ico">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:Inter,sans-serif;
  background:#0f1115;
  color:#fff;
  overflow-x:hidden;
}

header{
  text-align:center;
  padding:40px 20px 24px;
}
header h1{
  font-size:2.6rem;
  font-weight:700;
}
header p{
  color:#9aa0aa;
  margin-top:6px;
}

.search-wrap{
  max-width:520px;
  margin:18px auto 0;
}
.search-wrap input{
  width:100%;
  padding:12px 16px;
  border-radius:14px;
  border:none;
  background:#1c1f28;
  color:#fff;
  font-size:1rem;
}

.games-wrapper{
  max-width:1300px;
  margin:auto;
  padding:20px;
}
.games-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:18px;
}

/* GAME CARD */
.game-card{
  background:#161922;
  border-radius:18px;
  overflow:hidden;
  cursor:pointer;
  transition:.2s;
}
.game-card:hover{
  transform:translateY(-6px);
}

/* THUMB */
.game-thumb{
  height:150px;
  background:#222 center/cover;
  position:relative;
}
.play-overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.35);
  font-weight:700;
  font-size:1.1rem;
  opacity:0;
  transition:.2s;
}
.game-card:hover .play-overlay{
  opacity:1;
}

/* MISSING BADGE */
.missing-badge{
  position:absolute;
  top:8px;
  left:8px;
  background:#ff4d4d;
  color:#fff;
  font-size:.7rem;
  padding:4px 6px;
  border-radius:6px;
  display:none;
}

/* INFO */
.game-info{
  padding:14px 16px;
}
.game-title{
  font-weight:600;
  font-size:1rem;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.game-meta{
  font-size:.8rem;
  color:#9aa0aa;
}

/* MODAL */
.modal-bg{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal-window{
  width:92%;
  max-width:1100px;
  height:84%;
  background:#181b24;
  border-radius:16px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.modal-header,
.modal-footer{
  padding:16px 20px;
  background:#20232d;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.modal-header span:first-child{
  font-weight:600;
}
.modal-header span:last-child{
  cursor:pointer;
}
.modal-footer button{
  padding:10px 18px;
  border-radius:10px;
  border:none;
  background:#2c3040;
  color:#fff;
  cursor:pointer;
}
.modal-footer button:last-child{
  background:#037aff;
}
.game-frame{
  flex:1;
  border:none;
}
</style>
</head>

<body>

<header>
  <h1>FoundryGames</h1>
  <p>Instant play. No limits. Just games.</p>
  <div class="search-wrap">
    <input id="search" placeholder="Search games...">
  </div>
</header>

<main class="games-wrapper">
  <div class="games-grid" id="grid"></div>
</main>

<script>
const grid = document.getElementById("grid");
const search = document.getElementById("search");

const IMG_BASE = "./imgs";
const ASSETS_API =
  "https://api.github.com/repos/cleverman456/googledocsalt.github.io/contents/assets";

/* SEARCH */
search.oninput = e => {
  const q = e.target.value.toLowerCase();
  document.querySelectorAll(".game-card").forEach(card=>{
    card.style.display = card.dataset.title.toLowerCase().includes(q)
      ? ""
      : "none";
  });
};

/* INIT GAMES */
async function initGames(){
  const res = await fetch(ASSETS_API);
  const files = await res.json();

  const games = files
    .filter(f => f.name.endsWith(".html"))
    .map(f => f.name.replace(".html",""))
    .sort((a,b)=>a.localeCompare(b)); // ✅ ALPHABETIZED

  const observer = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
      if(!entry.isIntersecting) return;

      const card = entry.target;
      const slug = card.dataset.title;
      const thumb = card.querySelector(".game-thumb");
      const badge = card.querySelector(".missing-badge");

      const exts = ["png","jpg","jpeg","webp"];
      let loaded = false;

      const tryLoad = i => {
        if(i >= exts.length){
          badge.style.display = "block"; // ✅ MISSING IMAGE BADGE
          return;
        }
        const img = new Image();
        img.src = `${IMG_BASE}/${slug}.${exts[i]}`;
        img.onload = ()=>{
          if(!loaded){
            loaded = true;
            thumb.style.backgroundImage = `url(${img.src})`;
          }
        };
        img.onerror = ()=>tryLoad(i+1);
      };

      tryLoad(0);
      observer.unobserve(card);
    });
  },{rootMargin:"150px"});

  games.forEach(slug=>{
    const card = document.createElement("div");
    card.className = "game-card";
    card.dataset.title = slug;

    card.innerHTML = `
      <div class="game-thumb">
        <div class="missing-badge">Missing Image</div>
        <div class="play-overlay">▶ Play</div>
      </div>
      <div class="game-info">
        <div class="game-title">${slug}</div>
        <div class="game-meta">Play Now</div>
      </div>
    `;

    card.onclick = ()=>openGame(slug);
    grid.appendChild(card);
    observer.observe(card);
  });
}

initGames();

/* MODAL */
function openGame(slug){
  const m = document.createElement("div");
  m.className = "modal-bg";
  m.innerHTML = `
    <div class="modal-window">
      <div class="modal-header">
        <span>${slug}</span>
        <span onclick="this.closest('.modal-bg').remove()">✖</span>
      </div>
      <iframe src="assets/${slug}.html" class="game-frame"></iframe>
      <div class="modal-footer">
        <button onclick="this.closest('.modal-bg').remove()">Close</button>
        <button onclick="document.querySelector('.game-frame').requestFullscreen()">⛶ Fullscreen</button>
      </div>
    </div>
  `;
  document.body.appendChild(m);
}
</script>

</body>
</html>
