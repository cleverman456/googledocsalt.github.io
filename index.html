<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title id="tabTitle">FoundryGames</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link id="favicon" rel="icon" href="./imgs/favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* ===== GENERAL ===== */
*{box-sizing:border-box;margin:0;padding:0}
html{height:100%;background:#0f1115}
body{min-height:100vh;font-family:Inter,sans-serif;color:#fff;overflow-x:hidden}
#stars{position:fixed;inset:0;z-index:0;pointer-events:none}
.site{position:relative;z-index:2}

/* ===== HEADER ===== */
header{
  padding:40px 20px 24px;
  text-align:center;
}
header h1{
  font-size:2.6rem;
  font-weight:700;
  margin-bottom:6px;
}
header p{
  font-size:1.1rem;
  color:#9aa0aa;
  margin-bottom:16px;
}

/* ===== SEARCH BAR ===== */
.search-wrap{
  margin:0 auto 20px;
  max-width:520px;
  display:flex;
  gap:10px;
}
.search-wrap input{
  flex:1;
  padding:12px 16px;
  border-radius:14px;
  border:none;
  background:#1c1f28;
  color:#fff;
  font-size:1rem;
}
.search-wrap input::placeholder{
  color:#888;
}
.search-wrap button{
  padding:12px 16px;
  border-radius:14px;
  border:none;
  background:#2c3040;
  color:#fff;
  cursor:pointer;
  font-weight:600;
  transition:.2s;
}
.search-wrap button:hover{
  background:#393f55;
}

/* ===== GAMES GRID ===== */
.games-wrapper{
  max-width:1300px;
  margin:0 auto;
  padding:20px;
}
.games-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
  gap:18px;
}

/* ===== GAME CARD ===== */
.game-card{
  background:rgba(22,25,34,.95);
  border-radius:18px;
  overflow:hidden;
  cursor:pointer;
  transition:.2s;
  box-shadow:0 6px 18px rgba(0,0,0,.22);
}
.game-card:hover{
  transform:translateY(-6px);
  box-shadow:0 12px 28px rgba(0,0,0,.42);
}

/* ===== THUMBNAIL ===== */
.game-thumb{
  width:100%;
  height:150px;
  background:#222;
  background-size:cover;
  background-position:center;
  position:relative;
  border-radius:8px;
}
.play-overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(3,122,255,.12);
  font-weight:700;
  font-size:1.1rem;
  opacity:0;
  transition:.18s;
}
.game-card:hover .play-overlay{opacity:1}

/* ===== GAME INFO ===== */
.game-info{
  padding:14px 16px 18px;
}
.game-title{
  font-weight:600;
  font-size:1rem;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  margin-bottom:4px;
}
.game-meta{
  font-size:.8rem;
  color:#9aa0aa;
  text-align:left;
}

/* ===== MODAL ===== */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px)}
.modal-window{width:92%;max-width:1100px;height:84%;background:#181b24;border-radius:16px;display:flex;flex-direction:column;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.modal-header,.modal-footer{padding:16px 24px;background:#20232d;display:flex;justify-content:space-between;align-items:center}
.modal-header{border-bottom:1px solid rgba(255,255,255,.06)}
.modal-header span:first-child{font-weight:600;font-size:1.1rem;text-transform:capitalize;letter-spacing:0.3px}
.modal-header span:last-child{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;transition:.2s;font-size:1.2rem}
.modal-header span:last-child:hover{background:rgba(255,255,255,.1)}
.modal-footer{border-top:1px solid rgba(255,255,255,.06);gap:12px}
.modal-footer button{padding:10px 20px;border-radius:10px;border:none;background:#2c3e50;color:#fff;font-weight:600;font-size:.95rem;cursor:pointer;transition:.2s;font-family:Inter,sans-serif}
.modal-footer button:first-child{background:#2c3040}
.modal-footer button:first-child:hover{background:#3a3f55}
.modal-footer button:last-child{background:#037aff}
.modal-footer button:last-child:hover{background:#0264d6;transform:translateY(-1px)}
.game-frame{flex:1;border:none}

/* ===== SETTINGS PANEL ===== */
.settings-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:2000}
.settings{width:380px;background:#181b24;border-radius:14px;padding:18px}
.settings h2{margin-bottom:12px;font-size:1.2rem}
.settings label{font-size:.95rem;color:#9aa0aa}
.settings select,.settings button{
  width:100%;
  margin-top:8px;
  padding:12px;
  border-radius:12px;
  border:none;
  background:#2c3040;
  color:#fff;
  font-size:1rem;
  cursor:pointer;
  transition:.2s;
}
.settings button:hover,.settings select:hover{background:#393f55}
</style>
</head>

<body>
<canvas id="stars"></canvas>

<div class="site">
<header>
  <h1>FoundryGames</h1>
  <p>Instant play. No limits. Just games.</p>
  <div class="search-wrap">
    <input id="search" placeholder="Search games...">
    <button onclick="openSettings()">⚙</button>
  </div>
</header>

<main class="games-wrapper">
  <div class="games-grid" id="grid"></div>
</main>
</div>

<!-- SETTINGS -->
<div class="settings-bg" id="settingsBG">
  <div class="settings">
    <h2>Settings</h2>
    <label>Cloak Template</label>
    <select id="cloakSelect">
      <option value="">None</option>
      <option value="docs">Google Docs</option>
      <option value="drive">Google Drive</option>
      <option value="clever">Clever</option>
      <option value="classroom">Classroom</option>
    </select>
    <label style="margin-top:10px">Randomize Tab</label>
    <button onclick="randomizeTab()">Random Title & Favicon</button>
    <label style="margin-top:10px">Panic Key</label>
    <p style="font-size:.75rem;color:#777">Press <b>ESC</b> to instantly cloak</p>
    <button style="margin-top:14px" onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
/* ===== STAR BACKGROUND ===== */
const canvas=document.getElementById("stars");
const ctx=canvas.getContext("2d");
let w,h,stars=[];
function resize(){w=canvas.width=innerWidth;h=canvas.height=innerHeight;stars=Array.from({length:(w*h)/9000},()=>({x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.4+.3,s:Math.random()*.25+.05,t:Math.random()*Math.PI*2}));}
function draw(){ctx.clearRect(0,0,w,h);stars.forEach(s=>{s.y+=s.s;s.t+=.03;if(s.y>h)s.y=-10;ctx.fillStyle=`rgba(255,255,255,${.6+Math.sin(s.t)*.4})`;ctx.beginPath();ctx.arc(s.x,s.y,s.r,0,Math.PI*2);ctx.fill();});requestAnimationFrame(draw);}
resize();draw();
addEventListener("resize",resize);

/* ===== SETTINGS ===== */
const cloaks={docs:{title:"Google Docs",icon:"https://upload.wikimedia.org/wikipedia/commons/e/ec/GDocs_Favicon_Recreation.png"},drive:{title:"Google Drive",icon:"https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png"},clever:{title:"Clever | Log in",icon:"https://assets.clever.com/favicon.ico"},classroom:{title:"Google Classroom",icon:"https://www.gstatic.com/classroom/logo_square_rounded.svg"}};
const settingsBG=document.getElementById("settingsBG");
const cloakSelect=document.getElementById("cloakSelect");
const favicon=document.getElementById("favicon");
function openSettings(){settingsBG.style.display="flex"}
function closeSettings(){settingsBG.style.display="none"}
cloakSelect.onchange=()=>{const c=cloaks[cloakSelect.value];if(!c)return;document.title=c.title;favicon.href=c.icon;localStorage.setItem("cloak",cloakSelect.value)};
const saved=localStorage.getItem("cloak");
if(saved&&cloaks[saved]){document.title=cloaks[saved].title;favicon.href=cloaks[saved].icon;cloakSelect.value=saved;}
addEventListener("keydown",e=>{if(e.key==="Escape"){document.title=cloaks.docs.title;favicon.href=cloaks.docs.icon}});
function randomizeTab(){const list=Object.values(cloaks);const r=list[Math.floor(Math.random()*list.length)];document.title=r.title;favicon.href=r.icon}

/* ===== SEARCH ===== */
const search=document.getElementById("search");
search.oninput=e=>{
  const q=e.target.value.toLowerCase();
  document.querySelectorAll(".game-card").forEach(c=>{
    c.style.display=c.dataset.title.toLowerCase().includes(q)?"":"none";
  });
};

const ASSETS_API="https://api.github.com/repos/cleverman456/googledocsalt.github.io/contents/assets";
const IMGS_API="https://api.github.com/repos/cleverman456/googledocsalt.github.io/contents/imgs";
const IMG_BASE="./imgs";
const grid=document.getElementById("grid");

async function initGames(){
  const imgRes = await fetch(IMGS_API);
  const imgFiles = await imgRes.json();
  const availableImages = imgFiles.map(f => f.name.toLowerCase());

  const assetRes = await fetch(ASSETS_API);
  const files = await assetRes.json();
  const games = files.filter(f => f.name.endsWith(".html"));

  const observer = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if(entry.isIntersecting){
        const thumb = entry.target.querySelector(".game-thumb");
        const slug = entry.target.dataset.title;

        const exts = ["png","jpg","jpeg","webp"];
        let found = false;

        for(const ext of exts){
          const name = `${slug}.${ext}`;
          if(availableImages.includes(name.toLowerCase())){
            const img = new Image();
            img.src = `${IMG_BASE}/${name}`;
            img.onload = () => {
              if(!found){
                found = true;
                thumb.style.backgroundImage = `url(${img.src})`;
                thumb.style.backgroundSize = "cover";
                thumb.style.backgroundPosition = "center";
              }
            };
            break;
          }
        }

        if(!found){
          thumb.style.background = "linear-gradient(135deg,#2c3040,#1c1f28)";
        }

        obs.unobserve(entry.target);
      }
    });
  }, {rootMargin:"150px"});

  games.forEach(f => {
    const slug = f.name.replace(".html",""); 
    const card = document.createElement("div");
    card.className = "game-card";
    card.dataset.title = slug;

    const thumb = document.createElement("div");
    thumb.className = "game-thumb";
    thumb.innerHTML = `<div class="play-overlay">▶ Play</div>`;

    card.innerHTML += `
      <div class="game-info">
        <div class="game-title">${slug.replace(/-/g," ")}</div>
        <div class="game-meta">Play Now</div>
      </div>
    `;

    card.prepend(thumb);
    card.onclick = () => openGame(slug);
    grid.appendChild(card);

    observer.observe(card);
  });
}

initGames();

/* ===== MODAL ===== */
function openGame(slug){
  const m=document.createElement("div");
  m.className="modal-bg";
  m.innerHTML=`
    <div class="modal-window">
      <div class="modal-header">
        <span>${slug.replace(/-/g," ")}</span>
        <span style="cursor:pointer" onclick="this.closest('.modal-bg').remove()">✖</span>
      </div>
      <iframe src="assets/${slug}.html" class="game-frame"></iframe>
      <div class="modal-footer">
        <button onclick="this.closest('.modal-bg').remove()">Close</button>
        <button onclick="document.querySelector('.modal-bg .game-frame').requestFullscreen()">⛶ Fullscreen</button>
      </div>
    </div>`;
  document.body.appendChild(m);
}
</script>
</body>
</html>
