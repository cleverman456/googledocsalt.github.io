<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title id="tabTitle">FoundryGames</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link id="favicon" rel="icon" href="./imgs/favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="./uv/uv.bundle.js"></script>
<script src="./uv/uv.config.js"></script>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
html { height: 100%; background: #0f1115; }
body { min-height: 100vh; font-family: Inter, sans-serif; color: #fff; overflow-x: hidden; }
#stars { position: fixed; inset: 0; z-index: 0; pointer-events: none; }
.site { position: relative; z-index: 1; }

/* HEADER */
header { text-align: center; padding: 40px 20px 24px; }
header h1 { font-size: 2.6rem; font-weight: 700; }
header p { font-size: 1.1rem; color: #9aa0aa; margin-top: 6px; }

/* SEARCH */
.search-wrap { margin: 18px auto 0; max-width: 520px; display: flex; gap: 10px; }
.search-wrap input { flex: 1; padding: 12px 16px; border-radius: 14px; border: none; background: #1c1f28; color: #fff; }
.search-wrap button { padding: 12px 16px; border-radius: 14px; border: none; background: #2c3040; color: #fff; cursor: pointer; }

.proxy-search {
  margin-top: 10px;
}

.proxy-search input {
  background: #161922;
}

.proxy-search button {
  background: #1f2330;
}


/* GRID */
.games-wrapper { max-width: 1300px; margin: auto; padding: 20px; }
.games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 18px; }

/* CARD */
.game-card { background: #161922; border-radius: 18px; overflow: hidden; cursor: pointer; transition: .2s; }
.game-card:hover { transform: translateY(-6px); }
.game-thumb { height: 150px; background: #222 center/cover; position: relative; }
.play-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,.35); font-weight: 700; font-size: 1.1rem; opacity: 0; transition: .2s; }
.game-card:hover .play-overlay { opacity: 1; }
.missing-badge { position: absolute; top: 8px; left: 8px; background: #ff4d4d; color: #fff; font-size: .7rem; padding: 4px 6px; border-radius: 6px; display: none; }
.game-info { padding: 14px 16px; }
.game-title { font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.game-meta { font-size: .8rem; color: #9aa0aa; }

/* SETTINGS */
.settings-bg { position: fixed; inset: 0; background: rgba(0,0,0,.6); display: none; align-items: center; justify-content: center; z-index: 2000; }
.settings { width: 380px; background: #181b24; border-radius: 14px; padding: 18px; }
.settings h2 { margin-bottom: 12px; }
.settings label { font-size: .95rem; color: #9aa0aa; }
.settings select, .settings button { width: 100%; margin-top: 8px; padding: 12px; border-radius: 12px; border: none; background: #2c3040; color: #fff; cursor: pointer; }

/* MODAL */
.modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,.85); display: flex; align-items: center; justify-content: center; z-index: 1000; }
.modal-window { width: 92%; max-width: 1100px; height: 84%; background: #181b24; border-radius: 16px; display: flex; flex-direction: column; }
.modal-header, .modal-footer { padding: 16px; background: #20232d; display: flex; justify-content: space-between; }
.game-frame { flex: 1; border: none; }
</style>
</head>
<body>

<canvas id="stars"></canvas>

<div class="site">
  <header>
    <h1>FoundryGames</h1>
    <p>Instant play. No limits. Just games.</p>
    <div class="search-wrap">
      <input id="search" placeholder="Search games...">
      <button onclick="openSettings()">⚙</button>
    </div>
    <div class="search-wrap proxy-search">
  <input id="proxyInput" placeholder="Search or enter website…">
  <button id="proxyBtn">NOT WORKING DO NOT USE!</button>
    </div>

  </header>
  
  <main class="games-wrapper">
    <div class="games-grid" id="grid"></div>
  </main>
</div>

<!-- SETTINGS -->
<div class="settings-bg" id="settingsBG">
  <div class="settings">
    <h2>Settings</h2>
    <label>Cloak Template</label>
    <select id="cloakSelect">
      <option value="">None</option>
      <option value="docs">Google Docs</option>
      <option value="drive">Google Drive</option>
      <option value="clever">Clever</option>
      <option value="classroom">Classroom</option>
    </select>
    <label style="margin-top:10px">Randomize Tab</label>
    <button onclick="randomizeTab()">Random Title & Favicon</button>
    <label style="margin-top:10px">Panic Key</label>
    <p style="font-size:.75rem;color:#777">Press <b>ESC</b> to cloak</p>
    <button style="margin-top:14px" onclick="closeSettings()">Close</button>
  </div>
</div>

<script>
/* ⭐ STAR BACKGROUND */
const canvas = document.getElementById("stars");
const ctx = canvas.getContext("2d");
let stars = [], w, h;

function resize() {
  w = canvas.width = innerWidth;
  h = canvas.height = innerHeight;
  stars = Array.from({length: (w*h)/9000}, () => ({
    x: Math.random()*w,
    y: Math.random()*h,
    r: Math.random()*1.4+.3,
    s: Math.random()*.25+.05
  }));
}

function draw() {
  ctx.clearRect(0,0,w,h);
  stars.forEach(s=>{
    s.y += s.s;
    if(s.y>h) s.y = -10;
    ctx.fillStyle="rgba(255,255,255,.8)";
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(draw);
}

resize();
draw();
addEventListener("resize", resize);

/* SETTINGS LOGIC */
const cloaks = {
  docs: {title:"Google Docs", icon:"https://upload.wikimedia.org/wikipedia/commons/e/ec/GDocs_Favicon_Recreation.png"},
  drive: {title:"Google Drive", icon:"https://ssl.gstatic.com/images/branding/product/1x/drive_2020q4_32dp.png"},
  clever: {title:"Clever | Log in", icon:"https://assets.clever.com/favicon.ico"},
  classroom: {title:"Google Classroom", icon:"https://www.gstatic.com/classroom/logo_square_rounded.svg"}
};

const settingsBG = document.getElementById("settingsBG");
const cloakSelect = document.getElementById("cloakSelect");
const favicon = document.getElementById("favicon");

function openSettings() { settingsBG.style.display="flex"; }
function closeSettings() { settingsBG.style.display="none"; }

cloakSelect.onchange = () => {
  const c = cloaks[cloakSelect.value];
  if(!c) return;
  document.title = c.title;
  favicon.href = c.icon;
};

function randomizeTab() {
  const list = Object.values(cloaks);
  const r = list[Math.floor(Math.random()*list.length)];
  document.title = r.title;
  favicon.href = r.icon;
}

document.addEventListener("keydown", e => {
  if (e.key === "Escape") {
    document.title = "Google Docs";
    favicon.href = "https://upload.wikimedia.org/wikipedia/commons/e/ec/GDocs_Favicon_Recreation.png";
    location.replace("about:blank");
  }
});


/* SEARCH */
search.oninput = e => {
  const q = e.target.value.toLowerCase();
  document.querySelectorAll(".game-card").forEach(c => {
    c.style.display = c.dataset.title.toLowerCase().includes(q) ? "" : "none";
  });
};

/* GAMES */
const grid = document.getElementById("grid");
const IMG_BASE = "./imgs";
const ASSETS_API = "https://api.github.com/repos/cleverman456/googledocsalt.github.io/contents/assets";

async function initGames() {
  const res = await fetch(ASSETS_API);
  const files = await res.json();
  const games = files
    .filter(f => f.name.endsWith(".html"))
    .map(f => f.name.replace(".html",""))
    .sort((a,b)=>a.localeCompare(b));

  const observer = new IntersectionObserver(entries=>{
    entries.forEach(e=>{
      if(!e.isIntersecting) return;
      const card = e.target;
      const slug = card.dataset.title;
      const thumb = card.querySelector(".game-thumb");
      const badge = card.querySelector(".missing-badge");
      const exts = ["png","jpg","jpeg","webp"];
      let loaded = false;
      const tryLoad = i => {
        if(i>=exts.length){ badge.style.display="block"; return; }
        const img = new Image();
        img.src = IMG_BASE+"/"+slug+"."+exts[i];
        img.onload = () => { if(!loaded){ loaded=true; thumb.style.backgroundImage=`url(${img.src})`; } };
        img.onerror = () => tryLoad(i+1);
      };
      tryLoad(0);
      observer.unobserve(card);
    });
  }, { rootMargin:"150px" });

  games.forEach(slug=>{
    const card = document.createElement("div");
    card.className = "game-card";
    card.dataset.title = slug;
    card.innerHTML = `
      <div class="game-thumb">
        <div class="missing-badge">Missing Image</div>
        <div class="play-overlay">▶ Play</div>
      </div>
      <div class="game-info">
        <div class="game-title">${slug}</div>
        <div class="game-meta">Play Now</div>
      </div>`;
    card.onclick = () => openGame(slug);
    grid.appendChild(card);
    observer.observe(card);
  });
}

initGames();

/* MODAL */
function openGame(slug) {
  const m = document.createElement("div");
  m.className = "modal-bg";
  m.innerHTML = `
    <div class="modal-window">
      <div class="modal-header">
        <span>${slug}</span>
        <span onclick="this.closest('.modal-bg').remove()">✖</span>
      </div>
      <iframe src="assets/${slug}.html" class="game-frame"></iframe>
      <div class="modal-footer">
        <button onclick="this.closest('.modal-bg').remove()">Close</button>
        <button onclick="document.querySelector('.game-frame').requestFullscreen()">⛶ Fullscreen</button>
      </div>
    </div>`;
  document.body.appendChild(m);
}

/* =======================
   UV PROXY (ISOLATED)
   ======================= */

document.getElementById("proxyBtn").onclick = () => {
  let val = proxyInput.value.trim();
  if (!val) return;

  if (!val.includes("://")) val = "https://" + val;

  const encoded = __uv$config.prefix + __uv$config.encodeUrl(val);
  openProxyModal(encoded, val);
};

function openProxyModal(src, title) {
  const m = document.createElement("div");
  m.className = "modal-bg";
  m.innerHTML = `
    <div class="modal-window">
      <div class="modal-header">
        <span>${title}</span>
        <span onclick="this.closest('.modal-bg').remove()">✖</span>
      </div>
      <iframe class="game-frame" src="${src}"></iframe>
      <div class="modal-footer">
        <button onclick="this.closest('.modal-bg').remove()">Close</button>
        <button onclick="document.querySelector('.game-frame').requestFullscreen()">⛶ Fullscreen</button>
      </div>
    </div>`;
  document.body.appendChild(m);
}

</script>

</body>
</html>
