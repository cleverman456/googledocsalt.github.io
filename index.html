<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title id="tabTitle">FoundryGames</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link id="favicon" rel="icon" href="./imgs/favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;margin:0;padding:0}
html{height:100%;background:#0f1115}
body{min-height:100vh;font-family:Inter,sans-serif;color:#fff;overflow-x:hidden}
#stars{position:fixed;inset:0;z-index:0;pointer-events:none}
.site{position:relative;z-index:2}

header{padding:40px 20px 24px;text-align:center}
header h1{font-size:2.6rem;font-weight:700;margin-bottom:6px}
header p{font-size:1.1rem;color:#9aa0aa;margin-bottom:16px}

.search-wrap{margin:0 auto 20px;max-width:520px;display:flex;gap:10px}
.search-wrap input{flex:1;padding:12px 16px;border-radius:14px;border:none;background:#1c1f28;color:#fff}
.search-wrap button{padding:12px 16px;border-radius:14px;border:none;background:#2c3040;color:#fff;cursor:pointer}

.games-wrapper{max-width:1300px;margin:0 auto;padding:20px}
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:18px}

.game-card{background:#161922;border-radius:18px;overflow:hidden;cursor:pointer;transition:.2s}
.game-card:hover{transform:translateY(-6px)}

.game-thumb{width:100%;height:150px;background:#222;background-size:cover;background-position:center;position:relative}
.play-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(3,122,255,.15);opacity:0}
.game-card:hover .play-overlay{opacity:1}

.game-info{padding:14px 16px}
.game-title{font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.game-meta{font-size:.8rem;color:#9aa0aa}

.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal-window{width:92%;max-width:1100px;height:84%;background:#181b24;border-radius:16px;display:flex;flex-direction:column}
.modal-header,.modal-footer{padding:16px;background:#20232d;display:flex;justify-content:space-between}
.game-frame{flex:1;border:none}
</style>
</head>

<body>
<canvas id="stars"></canvas>

<div class="site">
<header>
  <h1>FoundryGames</h1>
  <p>Instant play. No limits. Just games.</p>
  <div class="search-wrap">
    <input id="search" placeholder="Search games...">
    <button onclick="openSettings()">âš™</button>
  </div>
</header>

<main class="games-wrapper">
  <div class="games-grid" id="grid"></div>
</main>
</div>

<script>
/* ===== STAR BACKGROUND ===== */
const canvas=document.getElementById("stars");
const ctx=canvas.getContext("2d");
let w,h,stars=[];
function resize(){
  w=canvas.width=innerWidth;
  h=canvas.height=innerHeight;
  stars=Array.from({length:(w*h)/9000},()=>({
    x:Math.random()*w,
    y:Math.random()*h,
    r:Math.random()*1.4+.3,
    s:Math.random()*.25+.05
  }));
}
function draw(){
  ctx.clearRect(0,0,w,h);
  stars.forEach(s=>{
    s.y+=s.s;
    if(s.y>h)s.y=-10;
    ctx.fillStyle="#fff";
    ctx.beginPath();
    ctx.arc(s.x,s.y,s.r,0,Math.PI*2);
    ctx.fill();
  });
  requestAnimationFrame(draw);
}
resize();draw();
addEventListener("resize",resize);

/* ===== SEARCH ===== */
search.oninput=e=>{
  const q=e.target.value.toLowerCase();
  document.querySelectorAll(".game-card").forEach(c=>{
    c.style.display=c.dataset.title.toLowerCase().includes(q)?"":"none";
  });
};

/* ===== GAME LOADER ===== */
const ASSETS_API="https://api.github.com/repos/cleverman456/googledocsalt.github.io/contents/assets";
const IMGS_API="https://api.github.com/repos/cleverman456/googledocsalt.github.io/contents/imgs";
const IMG_BASE="./imgs";
const grid=document.getElementById("grid");

async function initGames(){
  const imgRes = await fetch(IMGS_API);
  const imgFiles = await imgRes.json();
  const availableImages = imgFiles.map(f => f.name); // ðŸ”´ FIXED

  const assetRes = await fetch(ASSETS_API);
  const files = await assetRes.json();
  const games = files.filter(f => f.name.endsWith(".html"));

  const observer = new IntersectionObserver(entries=>{
    entries.forEach(entry=>{
      if(!entry.isIntersecting) return;
      const card = entry.target;
      const slug = card.dataset.title;
      const thumb = card.querySelector(".game-thumb");

      const exts=["png","jpg","jpeg","webp"];
      let found=false;

      for(const ext of exts){
        const name = `${slug}.${ext}`;
        if(availableImages.includes(name)){ // ðŸ”´ FIXED
          thumb.style.backgroundImage=`url(${IMG_BASE}/${name})`;
          found=true;
          break;
        }
      }

      if(!found){
        thumb.style.background="linear-gradient(135deg,#2c3040,#1c1f28)";
      }

      observer.unobserve(card);
    });
  },{rootMargin:"150px"});

  games.forEach(f=>{
    const slug=f.name.replace(".html","");
    const card=document.createElement("div");
    card.className="game-card";
    card.dataset.title=slug;

    card.innerHTML=`
      <div class="game-thumb">
        <div class="play-overlay">â–¶ Play</div>
      </div>
      <div class="game-info">
        <div class="game-title">${slug}</div>
        <div class="game-meta">Play Now</div>
      </div>
    `;

    card.onclick=()=>openGame(slug);
    grid.appendChild(card);
    observer.observe(card);
  });
}

initGames();

/* ===== MODAL ===== */
function openGame(slug){
  const m=document.createElement("div");
  m.className="modal-bg";
  m.innerHTML=`
    <div class="modal-window">
      <div class="modal-header">
        <span>${slug}</span>
        <span style="cursor:pointer" onclick="this.closest('.modal-bg').remove()">âœ–</span>
      </div>
      <iframe src="assets/${slug}.html" class="game-frame"></iframe>
      <div class="modal-footer">
        <button onclick="this.closest('.modal-bg').remove()">Close</button>
        <button onclick="document.querySelector('.game-frame').requestFullscreen()">â›¶ Fullscreen</button>
      </div>
    </div>`;
  document.body.appendChild(m);
}
</script>
</body>
</html>
