<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Google Docs</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/e/ec/GDocs_Favicon_Recreation.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html { height: 100%; background: #0f1115; }
    body { min-height: 100vh; font-family: "Inter", sans-serif; color: #fff; overflow-x: hidden; }
    header { padding: 32px 20px 20px; text-align: center; }
    header h1 { font-size: 2.2rem; font-weight: 700; letter-spacing: -0.5px; }
    header p { margin-top: 8px; color: #9aa0aa; font-size: 0.95rem; }
    .like-wrapper { margin-top: 12px; display: flex; align-items: center; justify-content: center; gap: 8px; }
    .like-wrapper button { font-size: 1.2rem; padding: 6px 12px; border-radius: 8px; border: none; background: #037aff; color: #fff; cursor: pointer; transition: 0.2s; }
    .like-wrapper button:hover { background: #025dcc; }
    .games-wrapper { max-width: 1300px; margin: 20px auto; padding: 20px; }
    .games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 18px; }
    .game-card { background: rgba(22,25,34,0.95); border-radius: 18px; overflow: hidden; cursor: pointer; transition: transform 0.18s ease, box-shadow 0.18s ease; box-shadow: 0 6px 18px rgba(0,0,0,0.22); }
    .game-card:hover { transform: translateY(-6px); box-shadow: 0 12px 28px rgba(0,0,0,0.42); }
    .game-thumb { width: 100%; aspect-ratio: 1 / 1; background-size: cover; background-position: center; position: relative; display: block; }
    .play-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(3,122,255,0.12); color: #e7f6ff; font-size: 1rem; font-weight: 700; opacity: 0; transition: opacity 0.18s ease, transform 0.18s ease; }
    .game-card:hover .play-overlay { opacity: 1; transform: translateY(0); }
    .game-info { padding: 12px 14px 16px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .game-title { font-weight: 600; font-size: 0.95rem; margin-bottom: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .game-meta { font-size: 0.75rem; color: #9aa0aa; }
  </style>
</head>
<body>
  <header>
    <h1>FoundryGames</h1>
    <p>Instant play. No limits. Just games.</p>
    <div class="like-wrapper">
      <button id="like-btn">üëç Like</button>
      <span id="like-count">0</span>
    </div>
  </header>

  <main class="games-wrapper">
    <div class="games-grid"></div>
  </main>

  <script>
    // =========================
    // GLOBAL LIKE SYSTEM CONFIG
    // =========================
    const GITHUB_TOKEN = "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"; // <-- PUT YOUR TOKEN HERE
    const REPO = "cleverman456/googledocsalt.github.io";
    const LIKES_FILE_PATH = "assets/likes.json";
    const RAW_JSON_URL = `https://raw.githubusercontent.com/${REPO}/main/${LIKES_FILE_PATH}`;
    const API_URL = `https://api.github.com/repos/${REPO}/contents/${LIKES_FILE_PATH}`;

    const likeBtn = document.getElementById("like-btn");
    const likeCount = document.getElementById("like-count");

    // Fetch current likes
    async function fetchLikes() {
      try {
        const res = await fetch(RAW_JSON_URL);
        const data = await res.json();
        likeCount.textContent = data.likes || 0;
      } catch (e) {
        console.error("Failed to fetch likes:", e);
      }
    }

    // Add a like
    async function addLike() {
      try {
        const getRes = await fetch(API_URL, {
          headers: { Authorization: `token ${GITHUB_TOKEN}` }
        });
        const fileData = await getRes.json();
        const sha = fileData.sha;
        const content = JSON.parse(atob(fileData.content));
        content.likes = (content.likes || 0) + 1;

        const updateRes = await fetch(API_URL, {
          method: "PUT",
          headers: {
            Authorization: `token ${GITHUB_TOKEN}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            message: "Increase like",
            content: btoa(JSON.stringify(content, null, 2)),
            sha: sha
          })
        });

        if (!updateRes.ok) throw new Error("Failed to update likes");

        likeCount.textContent = content.likes;
      } catch (e) {
        console.error(e);
        alert("Error: Could not update likes. Check your token.");
      }
    }

    likeBtn.addEventListener("click", addLike);
    fetchLikes();

    // =========================
    // GAME LOADING CODE (simplified)
    // =========================
    const githubUser = "cleverman456";
    const githubRepo = "googledocsalt.github.io";
    const githubBranch = "main";
    const gamesFolder = "assets";

    async function loadGameFiles() {
      const api = `https://api.github.com/repos/${githubUser}/${githubRepo}/contents/${gamesFolder}`;
      const res = await fetch(api);
      const files = await res.json();
      return Array.isArray(files) ? files.filter(f => f.name.endsWith(".html")).map(f => {
        const slug = f.name.replace(".html","");
        const title = slug.replace(/-/g," ");
        return { slug, title };
      }) : [];
    }

    function buildCardElement(game) {
      const el = document.createElement("div");
      el.className = "game-card";
      el.setAttribute("data-slug", game.slug);
      el.innerHTML = `
        <div class="game-thumb" style="background-image:url('https://via.placeholder.com/300x300?text=Game')">
          <div class="play-overlay"><span class="icon">‚ñ∂</span>Play Now</div>
        </div>
        <div class="game-info">
          <div style="min-width:0">
            <div class="game-title">${game.title}</div>
            <div class="game-meta">Play Now</div>
          </div>
        </div>
      `;
      el.onclick = () => openGame(game.slug, game.title);
      return el;
    }

    function openGame(slug, title) {
      const modal = document.createElement("div");
      modal.className = "modal-bg";
      modal.innerHTML = `
        <div class="modal-window" style="width:90%;height:80%;background:#181b24;border-radius:14px;overflow:hidden;display:flex;flex-direction:column;">
          <div class="modal-header" style="padding:12px 18px;background:#20232d;border-bottom:1px solid #2a2f3a;color:#e6eef8;display:flex;justify-content:space-between;">
            <span>${title}</span>
            <span class="close-btn" onclick="this.closest('.modal-bg').remove()">‚úñ</span>
          </div>
          <iframe src="${gamesFolder}/${slug}.html" style="flex:1;border:none;background:#000;"></iframe>
        </div>
      `;
      document.body.appendChild(modal);
    }

    (async () => {
      const container = document.querySelector(".games-grid");
      const games = await loadGameFiles();
      container.innerHTML = "";
      games.forEach(game => {
        container.appendChild(buildCardElement(game));
      });
    })();
  </script>
</body>
</html>
